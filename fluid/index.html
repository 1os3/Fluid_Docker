<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>æµä½“ç²’å­æ¨¡æ‹Ÿå™¨ - é«˜æ€§èƒ½å®æ—¶WebGLæµä½“ä»¿çœŸ</title>

        <meta name="description" content="åŸºäºWebGLçš„é«˜æ€§èƒ½å®æ—¶ç²’å­æµä½“æ¨¡æ‹Ÿä¸æ¸²æŸ“ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§ç‰©ç†å‚æ•°è°ƒèŠ‚å’Œäº¤äº’æ¨¡å¼ã€‚">
        <meta name="keywords" content="æµä½“æ¨¡æ‹Ÿ,WebGL,ç²’å­ç³»ç»Ÿ,ç‰©ç†ä»¿çœŸ,å®æ—¶æ¸²æŸ“">

        <link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="flip.css"/>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    </head>

    <body>
        <script type="text/template" id="main">
            <style>
                .editing-ui {
                    display: none;
                }

                .simulating-ui {
                    display: none;
                }
            </style>

            <canvas id="canvas" width="1920" height="1080"></canvas>
            
            <div id="ui" class="control-panel">
                <div class="panel-header">
                    <h2>æµä½“æ¨¡æ‹Ÿæ§åˆ¶å°</h2>
                </div>
                
                <div class="control-group">
                    <div id="start-button" class="primary-button">
                        <span id="start-text">å¼€å§‹æ¨¡æ‹Ÿ</span>
                        <div class="button-icon">âš¡</div>
                    </div>
                </div>

                <div class="control-group editing-ui">
                    <div id="preset-button" class="secondary-button">
                        <span>éšæœºé¢„è®¾</span>
                        <div class="button-icon">ğŸ²</div>
                    </div>
                </div>

                <div class="control-group editing-ui">
                    <div class="slider-container">
                        <label class="slider-label">
                            <span>ç²’å­å¯†åº¦</span>
                            <span id="density-value" class="value-display">0.5</span>
                        </label>
                        <input type="range" id="density-slider" class="native-slider" min="0" max="1" step="0.01" value="0.5">
                    </div>
                    <div id="particle-count" class="info-text"></div>
                </div>

                <div class="control-group simulating-ui">
                    <div class="slider-container">
                        <label class="slider-label">
                            <span>æµåŠ¨æ€§</span>
                            <span id="fluidity-value" class="value-display">0.99</span>
                        </label>
                        <input type="range" id="fluidity-slider" class="native-slider" min="0.5" max="0.99" step="0.01" value="0.99">
                    </div>
                </div>

                <div class="control-group simulating-ui">
                    <div class="slider-container">
                        <label class="slider-label">
                            <span>æ¨¡æ‹Ÿé€Ÿåº¦</span>
                            <span id="speed-value" class="value-display">60 FPS</span>
                        </label>
                        <input type="range" id="speed-slider" class="native-slider" min="1" max="120" step="1" value="60">
                    </div>
                </div>

                <div class="control-group advanced-controls">
                    <button id="toggle-advanced" class="settings-button">
                        <span>é«˜çº§è®¾ç½®</span>
                        <div class="button-icon">âš™ï¸</div>
                    </button>
                    <div id="advanced-panel" class="advanced-panel" style="display: none;">
                        <div class="slider-container">
                            <label class="slider-label">
                                <span>ç½‘æ ¼åˆ†è¾¨ç‡</span>
                                <span id="resolution-value" class="value-display">40</span>
                            </label>
                            <input type="range" id="resolution-slider" class="native-slider" min="20" max="100" step="1" value="40">
                        </div>
                        <div class="slider-container">
                            <label class="slider-label">
                                <span>è¡¨é¢å¼ åŠ›</span>
                                <span id="tension-value" class="value-display">0.1</span>
                            </label>
                            <input type="range" id="tension-slider" class="native-slider" min="0" max="0.5" step="0.01" value="0.1">
                        </div>
                        <div class="slider-container">
                            <label class="slider-label">
                                <span>ç²˜æ€§</span>
                                <span id="viscosity-value" class="value-display">0.01</span>
                            </label>
                            <input type="range" id="viscosity-slider" class="native-slider" min="0" max="0.1" step="0.001" value="0.01">
                        </div>
                    </div>
                </div>

                <div class="performance-monitor">
                    <div class="perf-item">
                        <span class="perf-label">FPS:</span>
                        <span id="fps-display" class="perf-value">60</span>
                    </div>
                    <div class="perf-item">
                        <span class="perf-label">ç²’å­æ•°:</span>
                        <span id="particle-display" class="perf-value">0</span>
                    </div>
                    <div class="perf-item">
                        <span class="perf-label">GPUå†…å­˜:</span>
                        <span id="memory-display" class="perf-value">0 MB</span>
                    </div>
                </div>
            </div>

            <div id="quality-controls" class="quality-panel">
                <div class="quality-presets">
                    <button class="quality-btn" data-quality="low">çœç”µæ¨¡å¼</button>
                    <button class="quality-btn active" data-quality="medium">å¹³è¡¡æ¨¡å¼</button>
                    <button class="quality-btn" data-quality="high">é«˜è´¨é‡</button>
                    <button class="quality-btn" data-quality="ultra">æè‡´æ¨¡å¼</button>
                </div>
            </div>


            <div id="camera-panel" class="camera-control-panel editing-ui">
                <button id="toggle-camera" class="collapse-button">
                    <span>æ‘„åƒæœºæ§åˆ¶</span>
                    <div class="collapse-icon">â–¼</div>
                </button>
                <div id="camera-content" class="camera-content">
                    <div class="instruction-group">
                        <div class="instruction-item">
                            <kbd>ç©ºæ ¼</kbd> + <span class="action">æ‹–æ‹½</span> <span class="desc">æ—‹è½¬è§†è§’</span>
                        </div>
                        <div class="instruction-item">
                            <kbd>æ»šè½®</kbd> <span class="desc">ç¼©æ”¾è§†è§’</span>
                        </div>
                    </div>
                    <div class="instruction-group">
                        <h3>ç¼–è¾‘æ¨¡å¼</h3>
                        <div class="instruction-item">
                            <span class="action">åœ¨å¢™é¢ç»˜åˆ¶</span> <span class="desc">åˆ›å»ºå®¹å™¨</span>
                        </div>
                        <div class="instruction-item">
                            <span class="action">æ‹–æ‹½è¾¹ç•Œ</span> <span class="desc">è°ƒæ•´å¤§å°</span>
                        </div>
                        <div class="instruction-item">
                            <kbd>Shift</kbd> + <span class="action">æ‹–æ‹½</span> <span class="desc">ç§»åŠ¨å®¹å™¨</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="interaction-panel" class="interaction-control-panel">
                <button id="toggle-interaction" class="collapse-button">
                    <span>äº¤äº’æ§åˆ¶</span>
                    <div class="collapse-icon">â–¼</div>
                </button>
                <div id="interaction-content" class="interaction-content">
                    <div class="instruction-group">
                        <div class="instruction-item">
                            <span class="action">æ‹–æ‹½</span> <span class="desc">æ—‹è½¬æ‘„åƒæœº</span>
                        </div>
                        <div class="instruction-item">
                            <kbd>æ»šè½®</kbd> <span class="desc">ç¼©æ”¾è§†è§’</span>
                        </div>
                        <div class="instruction-item">
                            <span class="action">é¼ æ ‡ç§»åŠ¨</span> <span class="desc">æ¨åŠ¨ç²’å­</span>
                        </div>
                    </div>
                    <div class="interaction-strength">
                        <label>äº¤äº’å¼ºåº¦: <input type="range" id="interaction-strength" min="0" max="100" value="50"></label>
                    </div>
                </div>
            </div>

            <div id="footer">
               Create By <a href="http://david.li">David.li</a> and Improve By <a href="https://github.com/1os3">1os3</a> | <a href="https://github.com/1os3/Fluid_Docker.git">@https://github.com/1os3/Fluid_Docker.git</a>
            </div>
        </script>

        <script type="text/template" id="no-support">
            <div id="container">
                <div id="error"></div>
                <div id="video">æ‚¨ä»ç„¶å¯ä»¥è§‚çœ‹è§†é¢‘æ¼”ç¤ºï¼š<br/>
                    <iframe src="//player.bilibili.com/player.html?isOutside=true&aid=114562766476238&bvid=BV1zZjtzNEwe&cid=30128868916&p=1" width="854" height="480" style="margin-top: 7px;" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe>
                </div>
                <div id="linkback"><a href="http://david.li">david.li</a></div>
            </div>
        </script>


        <div id="placeholder"></div>


        <script src="performance-optimizer.js"></script>
        <script src="wrappedgl.js"></script>
        <script src="utilities.js"></script>
        <script src="camera.js"></script>
        <script src="boxeditor.js"></script>
        <script src="simulator.js"></script>
        <script src="renderer.js"></script>
        <script src="simulatorrenderer.js"></script>
        <script src="slider.js"></script>
        <script src="fluidparticles.js"></script>
        
        <script>
            // æ·»åŠ é¢æ¿æŠ˜å åŠŸèƒ½å’Œæ»‘å—äº‹ä»¶
            document.addEventListener('DOMContentLoaded', function() {
                // äº¤äº’é¢æ¿æŠ˜å åŠŸèƒ½
                const toggleInteractionButton = document.getElementById('toggle-interaction');
                const interactionPanel = document.getElementById('interaction-panel');
                
                if (toggleInteractionButton && interactionPanel) {
                    toggleInteractionButton.addEventListener('click', function() {
                        interactionPanel.classList.toggle('collapsed');
                    });
                }
                
                // æ‘„åƒæœºé¢æ¿æŠ˜å åŠŸèƒ½
                const toggleCameraButton = document.getElementById('toggle-camera');
                const cameraPanel = document.getElementById('camera-panel');
                
                if (toggleCameraButton && cameraPanel) {
                    toggleCameraButton.addEventListener('click', function() {
                        cameraPanel.classList.toggle('collapsed');
                    });
                }
                
                // æ·»åŠ åŸç”Ÿæ»‘å—çš„å®æ—¶æ•°å€¼æ›´æ–°
                function updateSliderValue(sliderId, valueId, formatter) {
                    const slider = document.getElementById(sliderId);
                    const valueDisplay = document.getElementById(valueId);
                    
                    if (slider && valueDisplay) {
                        slider.addEventListener('input', function() {
                            const value = parseFloat(this.value);
                            valueDisplay.textContent = formatter ? formatter(value) : value.toFixed(2);
                            valueDisplay.classList.add('value-updated');
                            setTimeout(() => {
                                valueDisplay.classList.remove('value-updated');
                            }, 300);
                        });
                    }
                }
                
                // æ»‘å—äº‹ä»¶ç›‘å¬å™¨å·²åœ¨FluidParticles.jsä¸­è®¾ç½®ï¼Œè¿™é‡Œä¸éœ€è¦é‡å¤è®¾ç½®
            });
        </script>

        <script>
            function concatenateWords (list) {
                if (list.length === 0) {
                    return '';
                } else if (list.length === 1) {
                    return "'" + list[0] + "'";
                } else {
                    var result = '';
                    for (var i = 0; i < list.length; ++i) {
                        result += "'" + list[i] + "'";
                        if (i < list.length - 1) {
                            result += i < list.length - 2 ? ', ' : ' and '
                        }
                    }

                    return result;
                }
            }

            WrappedGL.checkWebGLSupportWithExtensions(['ANGLE_instanced_arrays', 'WEBGL_depth_texture', 'OES_texture_float', 'OES_texture_float_linear', 'OES_texture_half_float', 'OES_texture_half_float_linear'],
                function () { //we have webgl
                    document.getElementById('placeholder').outerHTML = document.getElementById('main').innerHTML;
                    var fluidBox = new FluidParticles();
                }, function (hasWebGL, unsupportedExtensions) {
                    document.getElementById('placeholder').outerHTML = document.getElementById('no-support').innerHTML;
                    if (!hasWebGL) { //webgl not supported
                        document.getElementById('error').textContent = 'å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebGL';
                    } else {
                        document.getElementById('error').textContent = 'å¾ˆæŠ±æ­‰ï¼Œæ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒä»¥ä¸‹WebGLæ‰©å±•ï¼š' + concatenateWords(unsupportedExtensions) + (unsupportedExtensions.length > 1 ? 'ã€‚' : 'ã€‚');
                    }
                }
            );
        </script>
    </body>

</html>
