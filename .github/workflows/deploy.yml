name: ÈÉ®ÁΩ≤Âà∞ GitHub Pages

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ê£ÄÂá∫‰ª£Á†Å
      uses: actions/checkout@v4
      
    - name: ËÆæÁΩÆ Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ÂàõÂª∫ÊûÑÂª∫ÁõÆÂΩï
      run: |
        mkdir -p dist
        
    - name: Â§çÂà∂È°πÁõÆÊñá‰ª∂Âà∞ÊûÑÂª∫ÁõÆÂΩï
      run: |
        cp -r fluid/* dist/
        
    - name: ÂàõÂª∫Ê†πÁõÆÂΩïindex.htmlÈáçÂÆöÂêë
      run: |
        cat > dist/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="zh-CN">
        <head>
            <meta charset="utf-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>ÊµÅ‰ΩìÁ≤íÂ≠êÊ®°ÊãüÂô® - È´òÊÄßËÉΩÂÆûÊó∂WebGLÊµÅ‰Ωì‰ªøÁúü</title>
            <meta name="description" content="Âü∫‰∫éWebGLÁöÑÈ´òÊÄßËÉΩÂÆûÊó∂Á≤íÂ≠êÊµÅ‰ΩìÊ®°Êãü‰∏éÊ∏≤ÊüìÁ≥ªÁªüÔºåÊîØÊåÅÂ§öÁßçÁâ©ÁêÜÂèÇÊï∞Ë∞ÉËäÇÂíå‰∫§‰∫íÊ®°Âºè„ÄÇ">
            <meta name="keywords" content="ÊµÅ‰ΩìÊ®°Êãü,WebGL,Á≤íÂ≠êÁ≥ªÁªü,Áâ©ÁêÜ‰ªøÁúü,ÂÆûÊó∂Ê∏≤Êüì">
            <link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap' rel='stylesheet' type='text/css'>
            <link rel="stylesheet" href="flip.css"/>
            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        </head>
        <body>
            <script type="text/template" id="main">
                <style>
                    .editing-ui {
                        display: none;
                    }
                    .simulating-ui {
                        display: none;
                    }
                </style>
                <canvas id="canvas" width="1920" height="1080"></canvas>
                <div id="ui" class="control-panel">
                    <div class="panel-header">
                        <h2>ÊµÅ‰ΩìÊ®°ÊãüÊéßÂà∂Âè∞</h2>
                    </div>
                    <div class="control-group">
                        <div id="start-button" class="primary-button">
                            <span id="start-text">ÂºÄÂßãÊ®°Êãü</span>
                            <div class="button-icon">‚ö°</div>
                        </div>
                    </div>
                    <div class="control-group editing-ui">
                        <div id="preset-button" class="secondary-button">
                            <span>ÈöèÊú∫È¢ÑËÆæ</span>
                            <div class="button-icon">üé≤</div>
                        </div>
                    </div>
                    <div class="control-group editing-ui">
                        <div class="slider-container">
                            <label class="slider-label">
                                <span>Á≤íÂ≠êÂØÜÂ∫¶</span>
                                <span id="density-value" class="value-display">0.5</span>
                            </label>
                            <input type="range" id="density-slider" class="native-slider" min="0" max="1" step="0.01" value="0.5">
                        </div>
                        <div id="particle-count" class="info-text"></div>
                    </div>
                    <div class="control-group simulating-ui">
                        <div class="slider-container">
                            <label class="slider-label">
                                <span>ÊµÅÂä®ÊÄß</span>
                                <span id="fluidity-value" class="value-display">0.99</span>
                            </label>
                            <input type="range" id="fluidity-slider" class="native-slider" min="0.5" max="0.99" step="0.01" value="0.99">
                        </div>
                    </div>
                    <div class="control-group simulating-ui">
                        <div class="slider-container">
                            <label class="slider-label">
                                <span>Ê®°ÊãüÈÄüÂ∫¶</span>
                                <span id="speed-value" class="value-display">60 FPS</span>
                            </label>
                            <input type="range" id="speed-slider" class="native-slider" min="1" max="120" step="1" value="60">
                        </div>
                    </div>
                    <div class="control-group advanced-controls">
                        <button id="toggle-advanced" class="settings-button">
                            <span>È´òÁ∫ßËÆæÁΩÆ</span>
                            <div class="button-icon">‚öôÔ∏è</div>
                        </button>
                        <div id="advanced-panel" class="advanced-panel" style="display: none;">
                            <div class="slider-container">
                                <label class="slider-label">
                                    <span>ÁΩëÊ†ºÂàÜËæ®Áéá</span>
                                    <span id="resolution-value" class="value-display">40</span>
                                </label>
                                <input type="range" id="resolution-slider" class="native-slider" min="20" max="100" step="1" value="40">
                            </div>
                            <div class="slider-container">
                                <label class="slider-label">
                                    <span>Ë°®Èù¢Âº†Âäõ</span>
                                    <span id="tension-value" class="value-display">0.1</span>
                                </label>
                                <input type="range" id="tension-slider" class="native-slider" min="0" max="0.5" step="0.01" value="0.1">
                            </div>
                            <div class="slider-container">
                                <label class="slider-label">
                                    <span>Á≤òÊÄß</span>
                                    <span id="viscosity-value" class="value-display">0.01</span>
                                </label>
                                <input type="range" id="viscosity-slider" class="native-slider" min="0" max="0.1" step="0.001" value="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="performance-monitor">
                        <div class="perf-item">
                            <span class="perf-label">FPS:</span>
                            <span id="fps-display" class="perf-value">60</span>
                        </div>
                        <div class="perf-item">
                            <span class="perf-label">Á≤íÂ≠êÊï∞:</span>
                            <span id="particle-display" class="perf-value">0</span>
                        </div>
                        <div class="perf-item">
                            <span class="perf-label">GPUÂÜÖÂ≠ò:</span>
                            <span id="memory-display" class="perf-value">0 MB</span>
                        </div>
                    </div>
                </div>
                <div id="quality-controls" class="quality-panel">
                    <div class="quality-presets">
                        <button class="quality-btn" data-quality="low">ÁúÅÁîµÊ®°Âºè</button>
                        <button class="quality-btn active" data-quality="medium">Âπ≥Ë°°Ê®°Âºè</button>
                        <button class="quality-btn" data-quality="high">È´òË¥®Èáè</button>
                        <button class="quality-btn" data-quality="ultra">ÊûÅËá¥Ê®°Âºè</button>
                    </div>
                </div>
                <div id="camera-panel" class="camera-control-panel editing-ui">
                    <button id="toggle-camera" class="collapse-button">
                        <span>ÊëÑÂÉèÊú∫ÊéßÂà∂</span>
                        <div class="collapse-icon">‚ñº</div>
                    </button>
                    <div id="camera-content" class="camera-content">
                        <div class="instruction-group">
                            <div class="instruction-item">
                                <kbd>Á©∫Ê†º</kbd> + <span class="action">ÊãñÊãΩ</span> <span class="desc">ÊóãËΩ¨ËßÜËßí</span>
                            </div>
                            <div class="instruction-item">
                                <kbd>ÊªöËΩÆ</kbd> <span class="desc">Áº©ÊîæËßÜËßí</span>
                            </div>
                        </div>
                        <div class="instruction-group">
                            <h3>ÁºñËæëÊ®°Âºè</h3>
                            <div class="instruction-item">
                                <span class="action">Âú®Â¢ôÈù¢ÁªòÂà∂</span> <span class="desc">ÂàõÂª∫ÂÆπÂô®</span>
                            </div>
                            <div class="instruction-item">
                                <span class="action">ÊãñÊãΩËæπÁïå</span> <span class="desc">Ë∞ÉÊï¥Â§ßÂ∞è</span>
                            </div>
                            <div class="instruction-item">
                                <kbd>Shift</kbd> + <span class="action">ÊãñÊãΩ</span> <span class="desc">ÁßªÂä®ÂÆπÂô®</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="interaction-panel" class="interaction-control-panel">
                    <button id="toggle-interaction" class="collapse-button">
                        <span>‰∫§‰∫íÊéßÂà∂</span>
                        <div class="collapse-icon">‚ñº</div>
                    </button>
                    <div id="interaction-content" class="interaction-content">
                        <div class="instruction-group">
                            <div class="instruction-item">
                                <span class="action">ÊãñÊãΩ</span> <span class="desc">ÊóãËΩ¨ÊëÑÂÉèÊú∫</span>
                            </div>
                            <div class="instruction-item">
                                <kbd>ÊªöËΩÆ</kbd> <span class="desc">Áº©ÊîæËßÜËßí</span>
                            </div>
                            <div class="instruction-item">
                                <span class="action">Èº†Ê†áÁßªÂä®</span> <span class="desc">Êé®Âä®Á≤íÂ≠ê</span>
                            </div>
                        </div>
                        <div class="interaction-strength">
                            <label>‰∫§‰∫íÂº∫Â∫¶: <input type="range" id="interaction-strength" min="0" max="100" value="50"></label>
                        </div>
                    </div>
                </div>
                <div id="footer">
                   Create By <a href="http://david.li">David.li</a> and Improve By <a href="https://github.com/1os3">1os3</a> | <a href="https://github.com/1os3/Fluid_Docker.git">@https://github.com/1os3/Fluid_Docker.git</a>
                </div>
            </script>
            <script type="text/template" id="no-support">
                <div id="container">
                    <div id="error"></div>
                    <div id="video">You can still view a video.<br/>
                        <iframe width="854" height="480" style="margin-top: 7px;" src="https://www.youtube.com/embed/DhNt_A3k4B4" frameborder="0" allowfullscreen></iframe> 
                    </div>
                    <div id="linkback"><a href="http://david.li">david.li</a></div>
                </div>
            </script>
            <script src="utilities.js"></script>
            <script src="wrappedgl.js"></script>
            <script src="camera.js"></script>
            <script src="boxeditor.js"></script>
            <script src="renderer.js"></script>
            <script src="simulatorrenderer.js"></script>
            <script src="simulator.js"></script>
            <script src="fluidparticles.js"></script>
            <script src="slider.js"></script>
            <script src="performance-optimizer.js"></script>
        </body>
        </html>
        EOF
        
    - name: ËÆæÁΩÆ GitHub Pages
      uses: actions/configure-pages@v4
      
    - name: ‰∏ä‰º†ÊûÑÂª∫‰∫ßÁâ©
      uses: actions/upload-pages-artifact@v3
      with:
        path: ./dist

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    
    steps:
    - name: ÈÉ®ÁΩ≤Âà∞ GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4 